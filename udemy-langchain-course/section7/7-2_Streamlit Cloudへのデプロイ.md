# セクション7-2: Streamlit Cloudへのデプロイ

## イントロダクション

みなさん、こんにちは。

前回は、作成したRAGアプリケーションをGitHubにプッシュしました。

今回は、Streamlit Cloudを使って、アプリケーションをWebに公開する手順を説明します。

Streamlit Cloudは、Streamlitアプリケーションを無料でホスティングできるサービスです。

## Streamlit Cloudアカウントの作成

まず、Streamlit Cloudのアカウントを作成しましょう。

ブラウザで「share.streamlit.io」にアクセスしてください。

「Sign up」ボタンをクリックします。

GitHubアカウントでサインインすることをお勧めします。

「Continue with GitHub」をクリックして、GitHubアカウントと連携してください。

これにより、GitHubリポジトリへのアクセスが簡単になります。

## 新しいアプリのデプロイ

サインインが完了したら、ダッシュボードが表示されます。

「New app」ボタンをクリックしてください。

デプロイ設定画面が表示されます。

以下の情報を入力します：

1. **Repository**: 先ほど作成した「company-doc-search-app」を選択
2. **Branch**: 「main」を選択
3. **Main file path**: 「app.py」と入力

「Deploy!」ボタンをクリックする前に、もう一つ重要な設定があります。

## 環境変数の設定

「Advanced settings」をクリックして展開してください。

「Secrets」セクションが表示されます。

ここに、OpenAIのAPIキーを設定する必要があります。

以下の内容を入力してください：

```
OPENAI_API_KEY = "あなたのAPIキー"
```

実際のAPIキーを引用符で囲んで入力してください。

これで、アプリケーションが環境変数にアクセスできるようになります。

## デプロイの実行

すべての設定が完了したら、「Deploy!」ボタンをクリックします。

デプロイが開始され、進行状況が表示されます。

初回のデプロイには5〜10分程度かかる場合があります。

デプロイログを確認して、エラーが発生していないか確認してください。

## デプロイエラーの対処

もしデプロイ中にエラーが発生した場合、以下の点を確認してください：

1. **requirements.txtの確認**
   - 必要なパッケージがすべて記載されているか
   - バージョンの競合がないか

2. **Pythonバージョン**
   - Streamlit CloudはPython 3.7以上をサポートしています

3. **ファイルパスの確認**
   - app.pyがリポジトリのルートにあるか

よくあるエラーとして、ChromaDBのインストールに関する問題があります。

もしエラーが発生した場合は、`requirements.txt`に以下を追加してみてください：

```
chromadb==0.4.22
```

## アプリケーションの確認

デプロイが成功すると、アプリケーションのURLが表示されます。

URLは以下のような形式になります：

```
https://あなたのアプリ名.streamlit.app
```

このURLをクリックして、アプリケーションにアクセスしてください。

## 初期設定の問題

デプロイ直後のアプリケーションでは、いくつか問題があります：

1. **ベクトルデータベースが空**
   - PDFファイルをアップロードしても、永続化されません

2. **ファイルアップロードの制限**
   - Streamlit Cloudには200MBのファイルサイズ制限があります

これらの問題の解決方法は、次のセクションで説明します。

## アプリケーションの管理

Streamlit Cloudのダッシュボードから、以下の管理機能が利用できます：

1. **ログの確認**
   - アプリケーションのログをリアルタイムで確認

2. **再起動**
   - アプリケーションを再起動

3. **設定の変更**
   - 環境変数やその他の設定を変更

4. **アナリティクス**
   - アプリケーションの使用状況を確認

## カスタムドメインの設定

有料プランでは、カスタムドメインを設定することも可能です。

無料プランでも、提供されるURLは十分に使いやすいものです。

## まとめ

今回は、Streamlit Cloudを使ってRAGアプリケーションをデプロイする手順を説明しました。

重要なポイントは：
- GitHubとの連携でデプロイが簡単
- 環境変数はSecrets機能で安全に管理
- 無料プランでも基本的な機能は十分

次回は、デプロイしたアプリケーションの改善点について説明します。

それでは、次のレッスンでお会いしましょう。